local PlPtrs = {
0x4156C8,0x4156DF,0x41726B,0x417838,0x4179CE,0x417B76,0x417C67,0x4189AA,0x418CEA,0x419D0F,0x419FD6,0x41A268,0x41F966,0x41F96D,0x41F9B5,0x41FD26,0x420BE7,0x420BEC,0x420F9F,0x425BB2,0x425BB9,0x430460,0x430468,0x4306EB,0x4306F2,
0x43073F,0x430746,0x430A85,0x430B40,0x430CFE,0x430E12,0x430E53,0x43128D,0x431555,0x43155C,0x431584,0x43158B,0x431661,0x4317DE,0x4317E5,0x431875,0x431939,0x431980,0x431987,0x431A53,0x431A5A,0x431B36,0x431B3D,0x431B96,0x431B9D,
0x431BCC,0x431BD3,0x431C65,0x431C6C,0x431CB7,0x431CBE,0x431D12,0x431D1B,0x431DBB,0x431DC3,0x431E35,0x431E3D,0x431E90,0x431E97,0x431ED7,0x431EDE,0x431F4A,0x431F53,0x432130,0x432137,0x43232E,0x432336,0x4325C7,0x432745,0x43274D,
0x4327E0,0x4327E8,0x436E95,0x4383EC,0x43994E,0x43A3C6,0x43BB4B,0x4419CB,0x4419D2,0x442DF4,0x442DFD,0x4431AB,0x4431B2,0x4439C4,0x443BC1,0x443BCB,0x443C0B,0x443C12,0x443C7A,0x443C82,0x443CB5,0x443CBC,0x444224,0x44424B,0x444252,
0x44428A,0x4442C2,0x4442C9,0x444307,0x44432E,0x444335,0x44436D,0x4443A5,0x4443AC,0x444531,0x444538,0x4445A1,0x4445D5,0x4445E1,0x4446BD,0x4446C6,0x444764,0x44476C,0x444823,0x44482A,0x44488B,0x4448BF,0x4448CB,0x44493C,0x444943,
0x4449A4,0x4449D8,0x4449E4,0x444A55,0x444A5C,0x444ABD,0x444AF1,0x444AFD,0x444CA4,0x444CCC,0x444CD3,0x444D0A,0x444D41,0x444D48,0x45CCA8,0x45CCAF,0x45CCFF,0x45CD08,0x46154C,0x461553,0x461645,0x46164D,0x4617C7,0x4617CE,0x461819,
0x461820,0x467417,0x468946,0x46894F,0x472701,0x472AC0,0x472BD3,0x48C0CB,0x491D2F,0x4924EF,0x492A46,0x49407B,0x494083,0x4C561E,0x4C5628,0x4C82C8,0x4C8CE8,0x4C8E52,0x4C9DDC,0x4CA344,0x4CA34E,0x4CADC2,0x4CADCC,0x4CAF97,0x4CAFA1,
0x4CB145,0x4CB14F,0x4CB353,0x4CB35D,0x4D146E,0x4D16A0}

local function GetRefAdr(p, ref, prec, prec2)
	prec	= prec  or 0
	prec2	= prec2 or 0

	if p == nil then error("Address is nil.") end

	local cmd = mem.GetInstructionSize(p)
	local sh = 0
	while true do
		if sh >= cmd then
			break
		end
		local res = mem.u4[p+sh]
		if res >= ref - prec2 and res <= ref + prec then
			break
		end
		sh = sh + 1
	end
	return p+sh
end

local function Process(t, OldOrigin, NewOrigin, prec, prec2)
	local OldAddr
	local RefAddr
	for i, v in ipairs(t) do
		RefAddr = GetRefAdr(v, OldOrigin, prec, prec2)
		OldAddr = mem.u4[RefAddr]
		mem.u4[RefAddr] = NewOrigin + OldAddr - OldOrigin
	end
end

local PlPtrs2 = {
0x401BFF,0x40483E,0x40498E,0x405563,0x406102,0x40625C,0x4062F8,0x406436,0x40676A,0x406BA8,0x40E7F8,0x40E8E9,0x411F4A,0x412423,0x412ED5,0x412F42,0x4150FB,0x41569F,0x416478,0x416996,0x416B25,0x416B55,0x416BB4,0x41A24A,0x41A602,
0x41ABCA,0x41AFFD,0x41B01A,0x41C821,0x41CF0A,0x41CF3B,0x41CF92,0x41CFCC,0x41D028,0x41E062,0x41E114,0x41E165,0x41EAF7,0x41EFBB,0x41F457,0x42028C,0x4203A6,0x42052D,0x420A28,0x420FB6,0x4215F7,0x421728,0x42186B,0x424D77,0x424DDC,
0x424FAC,0x4250C1,0x42514F,0x425172,0x4252E4,0x425382,0x425666,0x42606B,0x4263C3,0x426589,0x427267,0x427414,0x4274D2,0x427576,0x4276A0,0x4277B5,0x4279CA,0x427A96,0x427AC5,0x42809C,0x42834D,0x4283F3,0x4287E3,0x428862,0x428A4A,
0x428AC6,0x428B85,0x428CA6,0x429792,0x429A55,0x429BDB,0x429C39,0x429D29,0x429E3B,0x42A06E,0x42A171,0x42A2DB,0x42A4B2,0x42A4D3,0x42A56E,0x42A58F,0x42A5C4,0x42ABAE,0x42ADC2,0x42ADD1,0x42AE48,0x42AF56,0x42AFCC,0x42B0E9,0x42B118,
0x42B199,0x42B1C8,0x42B1D7,0x42B249,0x42B263,0x42B2D1,0x42B346,0x42B458,0x42B7F6,0x42B825,0x42BA3F,0x42BA6E,0x42BC75,0x42BCE2,0x42BCFC,0x42BD1B,0x42BE25,0x42BE39,0x42BE92,0x42C118,0x42C62E,0x42C652,0x42C87E,0x42C913,0x42CBA0,
0x42D3F0,0x42D4B6,0x42D81B,0x42E79C,0x42E83A,0x42EA2A,0x42FF9A,0x43013D,0x4306B8,0x4317A4,0x431AEE,0x43241E,0x432AA4,0x432B25,0x4331A5,0x4336E0,0x4368D3,0x436C4C,0x437B34,0x437F58,0x437F8D,0x438382,0x438CD5,0x43DF7D,0x43E321,
0x43E616,0x4426F5,0x443729,0x44552B,0x446AEB,0x446EF8,0x446F1C,0x446F54,0x44783A,0x447A4C,0x447C58,0x448608,0x448F9D,0x449848,0x449925,0x453DBC,0x45CA35,0x45D1AB,0x45E9A0,0x460E25,0x461134,0x46636B,0x466588,0x46742A,0x4675CB,
0x467637,0x4676AD,0x4677AF,0x467850,0x467975,0x4679E2,0x467AA3,0x467B7E,0x468A46,0x471704,0x471898,0x471CEA,0x471FC6,0x472302,0x47244D,0x47279B,0x47299B,0x473108,0x4733C2,0x47384A,0x473873,0x473BA6,0x473EDA,0x474012,0x47404A,
0x474249,0x47522F,0x481F13,0x48BB63,0x48D529,0x48DFD4,0x48E01C,0x48FA40,0x48FA70,0x4901EE,0x49039D,0x4908B9,0x490A39,0x490BCD,0x490C2E,0x490F12,0x491691,0x491996,0x4919C8,0x491C16,0x491C46,0x491CA7,0x491F48,0x4923B4,0x4923E9,
0x49242A,0x4924CA,0x492504,0x492656,0x49287A,0x4929EA,0x492A0E,0x492BEC,0x4937CF,0x493D2B,0x493D4F,0x493D7E,0x493DA5,0x4AFEC9,0x4B017A,0x4B0437,0x4B0557,0x4B05F5,0x4B06C3,0x4B0951,0x4B09DF,0x4B0A95,0x4B0DD3,0x4B116E,0x4B14D8,
0x4B3110,0x4B3216,0x4B39F0,0x4B474F,0x4B512E,0x4B53F3,0x4B584C,		    0x4B5FCC,0x4B653C,0x4B67F1,0x4B7645,0x4B81B2,0x4B8DD2,0x4B9D6D,0x4B9EDF,0x4BA466,0x4BA7B6,0x4BAAC9,0x4BAAF5,0x4BACD1,0x4BAE24,0x4BAF35,0x4BB6CE,0x4BD5B4, --0x4B585E
0x4C4E68,0x4C6828,0x4C6B77,0x4C6B9E,0x4C7ADA,0x4C8038,0x4C818B,0x4CE4CB}

NewPartyPtr = mem.StaticAlloc(30000)

mem.IgnoreProtection(true)
Process(PlPtrs2, 0xB20E90, NewPartyPtr, 0, 0)
Process(PlPtrs,  0xB2187C, NewPartyPtr + 0xB2187C - 0xB20E90, 0, 0)
mem.IgnoreProtection(false)

structs.o.GameParty.PlayersArray = NewPartyPtr
internal.SetArrayUpval(Game.Party.PlayersArray, "o", NewPartyPtr)

