
local UIPics = {"fr_inven", "fr_inven1", "fr_inven2", "fr_inven3", "fr_inven4"}

local function InitUIGrids()

	local t = {}
	for i = 0, Party.PlayersArray.count - 1 do
		t[i] = 1
	end
	return t

end

local LastGrid = 1
local CurrentChar = 0
local ReplaceIcon = CustomUI.ReplaceIcon

local function SetGrid(Id)
	if LastGrid ~= Id then
		ReplaceIcon(UIPics[LastGrid], UIPics[Id])
		LastGrid = Id
	end
end

function events.LoadInventoryPics(Player, PlayerId)

	vars.UIGrids = vars.UIGrids or InitUIGrids()
	CurrentChar = PlayerId
	SetGrid(vars.UIGrids[PlayerId])

end

function events.GameInitialized2()

	-- New UI elements
	local function StdCond()
		return mem.u1[0x10061a0] ~= 1
	end

	local function GetSelectedMerc()
		return CurrentChar
	end

	local function NextGrid(Step)
		local Id = LastGrid + Step
		if Id < 1 then
			Id = #UIPics
		elseif Id > #UIPics then
			Id = 1
		end
		return Id
	end

	local X = 290

	CustomUI.CreateButton{
		IconUp = "SlClassLU",
		IconDown = "SlClassLD",
		X = X,
		Y = 3,
		Condition = StdCond,
		Action = function()
			local Id = NextGrid(-1)
			SetGrid(Id)
			vars.UIGrids[GetSelectedMerc()] = Id
		end,
		Layer = 1,
		Screen = 29}

	test = CustomUI.CreateButton{
		IconUp = "SlClassRU",
		IconDown = "SlClassRD",
		X = X + 138,
		Y = 3,
		Condition = StdCond,
		Action = function()
			local Id = NextGrid(1)
			SetGrid(Id)
			vars.UIGrids[GetSelectedMerc()] = Id
		end,
		Layer = 1,
		Screen = 29}

	CustomUI.CreateText{
		X = X + 22,
		Y = 3,
		Text = "Inventory grid",
		Layer = 1,
		Screen = 29,
		Condition = StdCond,
		Font = Game.Arrus_fnt}

end
